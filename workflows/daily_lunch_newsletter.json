{
  "name": "Daily Lunch Newsletter",
  "description": "ë§¤ì¼ 13ì‹œ(KST) ì£¼ì œë³„ ë‰´ìŠ¤ ìˆ˜ì§‘ â†’ Groq ìš”ì•½ â†’ Gmail ë°œì†¡",
  "active": false,
  "settings": { "timezone": "Asia/Seoul" },
  "nodes": [
    {
      "id": "n1",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [50, 400],
      "parameters": {}
    },
    {
      "id": "n2",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [50, 200],
      "parameters": {
        "triggerTimes": {
          "item": [{ "hours": [13], "minutes": [0] }]
        },
        "timezone": "Asia/Seoul"
      }
    },
    {
      "id": "n3",
      "name": "Topic List",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [300, 300],
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// ì£¼ì œë³„ RSS URL ëª©ë¡ ë°˜í™˜ (HTTP í˜¸ì¶œ ì—†ìŒ - ë°ì´í„°ë§Œ)\nreturn [\n  { json: { topic: 'êµ­ë‚´ì •ì¹˜', url: 'https://rss.donga.com/politics.xml' } },\n  { json: { topic: 'êµ­ì™¸ì •ì¹˜', url: 'https://rss.donga.com/foreign.xml' } },\n  { json: { topic: 'í˜¸ì£¼ì´ë¯¼', url: 'https://www.smh.com.au/rss/feed.xml' } },\n  { json: { topic: 'í˜¸ì£¼',    url: 'https://www.abc.net.au/news/feed/51120/rss.xml' } },\n  { json: { topic: 'ëŒ€í•œë¯¼êµ­', url: 'https://rss.donga.com/total.xml' } },\n  { json: { topic: 'AIë°SW',  url: 'https://techcrunch.com/feed/' } }\n];"
      }
    },
    {
      "id": "n4",
      "name": "Fetch RSS",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [550, 300],
      "parameters": {
        "method": "GET",
        "url": "={{ $json.url }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "text"
            }
          }
        }
      }
    },
    {
      "id": "n5",
      "name": "Parse RSS",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [800, 300],
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// XML íŒŒì‹± (HTTP í˜¸ì¶œ ì—†ìŒ - íŒŒì‹±ë§Œ)\nconst xml = $input.item.json.data || '';\nconst topic = $('Topic List').item.json.topic;\n\nconst articleList = [];\nconst itemRegex = /<item[^>]*>([\\s\\S]*?)<\\/item>/gi;\nlet match;\nwhile ((match = itemRegex.exec(xml)) !== null && articleList.length < 4) {\n  const block = match[1];\n  const title = (\n    block.match(/<title[^>]*><!\\[CDATA\\[([\\s\\S]*?)\\]\\]><\\/title>/) ||\n    block.match(/<title[^>]*>([\\s\\S]*?)<\\/title>/)\n  )?.[1]?.replace(/<[^>]+>/g, '').trim() || '';\n  if (title) articleList.push(`â€¢ ${title}`);\n}\n\nconst section = `[${topic}]\\n${articleList.length ? articleList.join('\\n') : 'ìˆ˜ì§‘ëœ ê¸°ì‚¬ ì—†ìŒ'}`;\nreturn { json: { topic, section } };"
      }
    },
    {
      "id": "n6",
      "name": "Build Groq Body",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1050, 300],
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// ëª¨ë“  ì„¹ì…˜ í•©ì¹˜ê³  Groq bodyë¥¼ JSON.stringifyë¡œ ì§ë ¬í™”\n// â†’ íŠ¹ìˆ˜ë¬¸ì ë¬¸ì œ ì›ì²œ ì°¨ë‹¨\nconst sections = $input.all().map(i => i.json.section).join('\\n\\n');\nconst date = new Date().toLocaleDateString('ko-KR', {\n  year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'\n});\n\nconst groqBody = JSON.stringify({\n  model: 'llama-3.3-70b-versatile',\n  messages: [\n    {\n      role: 'system',\n      content: 'ë‹¹ì‹ ì€ ì „ë¬¸ ë‰´ìŠ¤ ì—ë””í„°ì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ë‰´ìŠ¤ ê¸°ì‚¬ë“¤ì„ ì£¼ì œë³„ë¡œ ê°„ê²°í•˜ê²Œ ìš”ì•½í•´ì£¼ì„¸ìš”. ê° ì£¼ì œëŠ” 2~3ë¬¸ì¥ìœ¼ë¡œ í•µì‹¬ë§Œ ì •ë¦¬í•˜ê³ , ì ì‹¬ì‹œê°„ì— ì½ê¸° í¸í•œ ë‰´ìŠ¤ë ˆí„° í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. ì˜ì–´ ê¸°ì‚¬ë„ í•œêµ­ì–´ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”.'\n    },\n    {\n      role: 'user',\n      content: `ë‹¤ìŒ ë‰´ìŠ¤ë“¤ì„ ì£¼ì œë³„ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”:\\n\\n${sections}`\n    }\n  ],\n  max_tokens: 2000,\n  temperature: 0.3\n});\n\nreturn [{ json: { groqBody, date } }];"
      }
    },
    {
      "id": "n7",
      "name": "Groq Summarize",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1300, 300],
      "parameters": {
        "method": "POST",
        "url": "https://api.groq.com/openai/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json.groqBody }}",
        "options": {}
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "groq-credential",
          "name": "Groq API Key"
        }
      }
    },
    {
      "id": "n8",
      "name": "Build Email HTML",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1550, 300],
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Groq ì‘ë‹µ íŒŒì‹± + HTML ì´ë©”ì¼ ë¹Œë“œ (HTTP í˜¸ì¶œ ì—†ìŒ)\nconst groqResponse = $input.first().json;\nconst summary = groqResponse.choices?.[0]?.message?.content || 'ìš”ì•½ ìƒì„± ì‹¤íŒ¨';\nconst date = $('Build Groq Body').first().json.date;\n\nconst formatted = summary\n  .replace(/##\\s*(.+)/g, '<h2 style=\"color:#1a1a2e;border-bottom:2px solid #eee;padding-bottom:6px;margin-top:28px;\">$1</h2>')\n  .replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>')\n  .replace(/\\n/g, '<br>');\n\nconst html = `<!DOCTYPE html>\n<html lang=\"ko\">\n<head>\n<meta charset=\"UTF-8\">\n<style>\n  body{font-family:'Apple SD Gothic Neo','Malgun Gothic',sans-serif;max-width:680px;margin:0 auto;background:#f4f4f8;color:#222;}\n  .header{background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);color:white;padding:32px 36px;border-radius:12px 12px 0 0;}\n  .header h1{margin:0;font-size:22px;font-weight:700;}\n  .header p{margin:8px 0 0;opacity:0.6;font-size:12px;}\n  .content{background:white;padding:28px 36px;border-radius:0 0 12px 12px;line-height:1.9;font-size:14.5px;}\n  .footer{text-align:center;color:#bbb;font-size:11px;padding:20px;}\n</style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>ğŸ—ï¸ ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ ë¸Œë¦¬í•‘</h1>\n    <p>${date} Â· AI ìš”ì•½ë³¸</p>\n  </div>\n  <div class=\"content\">${formatted}</div>\n  <div class=\"footer\">ìë™ ë°œì†¡ Â· Daily Lunch Newsletter by n8n</div>\n</body>\n</html>`;\n\nreturn [{ json: {\n  subject: `ğŸ—ï¸ ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ ë¸Œë¦¬í•‘ - ${date}`,\n  html\n} }];"
      }
    },
    {
      "id": "n9",
      "name": "Gmail ë°œì†¡",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [1800, 300],
      "parameters": {
        "operation": "send",
        "sendTo": "YOUR_EMAIL@gmail.com",
        "subject": "={{ $json.subject }}",
        "emailType": "html",
        "message": "={{ $json.html }}",
        "options": {}
      },
      "credentials": {
        "gmailOAuth2": {
          "id": "gmail-oauth",
          "name": "Gmail Account"
        }
      }
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [[{ "node": "Topic List", "type": "main", "index": 0 }]]
    },
    "Schedule Trigger": {
      "main": [[{ "node": "Topic List", "type": "main", "index": 0 }]]
    },
    "Topic List": {
      "main": [[{ "node": "Fetch RSS", "type": "main", "index": 0 }]]
    },
    "Fetch RSS": {
      "main": [[{ "node": "Parse RSS", "type": "main", "index": 0 }]]
    },
    "Parse RSS": {
      "main": [[{ "node": "Build Groq Body", "type": "main", "index": 0 }]]
    },
    "Build Groq Body": {
      "main": [[{ "node": "Groq Summarize", "type": "main", "index": 0 }]]
    },
    "Groq Summarize": {
      "main": [[{ "node": "Build Email HTML", "type": "main", "index": 0 }]]
    },
    "Build Email HTML": {
      "main": [[{ "node": "Gmail ë°œì†¡", "type": "main", "index": 0 }]]
    }
  }
}